{% load i18n thumbnail rsr_filters %}

{% if organisations %}
    <style type="text/css" media="screen">
    	.mapInfoWindow {
    		min-height:150px;
    	}
    	.mapInfoWindow h4 {
    		color:#BE0903;
    		padding:5px 5px;
    	}

    	div.bubble_header {
    		background-color:#BE0903;
    		padding-top:8px;
    		padding-bottom:4px;
    		padding-left:5px;
    	}
    	div.bubble_header h3 {
    		color:#fff;
    	}
    </style>
    <script>
        // Grab variable definitions from the template
        var markers = [ {% for organisation in organisations %}
            {% for location in organisation.locations.valid %}
            {
                icon: {
                    image: '{{ marker_icon }}',
                {% if map_type == 'static' %}
                    iconsize: [10, 17],
                {% else %}
                    iconsize: [20, 34],
                {% endif %}
                shadow: ''
                },
                {% if map_type != 'static' %}
                html: '<div class="mapInfoWindow">' +
                      '<a href="' + '{{ organisation.get_absolute_url }}' + '">' +
                      '{{ organisation.name|smart_truncate:35}}</a><br>' +
                      '<a href="' + '{{ organisation.get_absolute_url }}' + '">' +
                      '<img src="{% thumbnail organisation.logo 100x100 autocrop sharpen %}" alt="" /></a>' +
                      '<p class="small grey" style="margin:0;">{% trans 'Location' %}: ' +
                      '{{ organisation.primary_location.country.get_continent_display }}' +
                      '{% if organisation.primary_location.city and organisation.primary_location.country %}, {% endif %}' +
                      '{{organisation.primary_location.city}}</p></div>' +
                      '</div>',
                {% endif %}
                latitude: {{ location.latitude }},
                longitude: {{ location.longitude }},
                popup: false
            },
            {% endfor %}
        {% endfor %} ];
        var zoom = {{ zoom }};
    </script>
{% endif %}
